"use strict";function createInputState(t){var e=InputState_1.input();return e.name=t,e.logEnabled=!1,e}Object.defineProperty(exports,"__esModule",{value:!0});var _=require("lodash"),Subject_1=require("rxjs/Subject"),InputState_1=require("./InputState"),StoreLog_1=require("./StoreLog"),Store=function(){function t(t){this.actionCompleted=new Subject_1.Subject,this.currentData=t;var e={};_.forIn(this.currentData,function(t,n){var a=createInputState(n);void 0!==t&&a.putValue(t),e[n]=a}),this.states=e}return t.prototype.action=function(t,e,n){var a=this;n=n||{};var r=_.isNil(this.transientDataInAction)?this.data:this.transientDataInAction,i=_.clone(r);this.transientDataInAction=i,e.apply(this,[i]),this.transientDataInAction=r;var o=new Set,s=new Set,u=new Set,c=(new Error).stack,d=new StoreLog_1.LogEvent(t,[],c);_.keysIn(i).forEach(function(t){var e=i[t];if(_.hasIn(r,t)){var n=r[t];_.eq(e,n)||(a.states[t].putValue(e),r[t]=e,s.add(t),u.add(t),_.isNil(e)?d.changes.push(["removed",t,e]):d.changes.push(["changed",t,e]))}else r[t]=e,o.add(t),u.add(t),a.states[t]=createInputState(t),a.states[t].putValue(e),d.changes.push(["added",t,e])}),StoreLog_1.logStoreEvent(d),this.actionCompleted.next(u),n.afterAction&&n.afterAction(this,i,s,o)},Object.defineProperty(t.prototype,"data",{get:function(){return this.currentData},enumerable:!0,configurable:!0}),t.prototype.select=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var a=this.actionCompleted.filter(function(t){return _.some(e,function(e){return t.has(e)})});return _.every(e,function(e){var n=t.states[e];return void 0!==n&&!!n.hasValue()})&&(a=a.startWith(new Set(e))),a.map(function(e){return{data:t.data,fields:new Set(e)}})},t.prototype.selectAll=function(){var t=this,e=this.data,n=_.keysIn(e).filter(function(t){return void 0!==_.get(e,t)});return this.actionCompleted.startWith(new Set(n)).map(function(e){return{data:t.data,fields:e}})},t}();exports.Store=Store;
//# sourceMappingURL=Store.js.map
