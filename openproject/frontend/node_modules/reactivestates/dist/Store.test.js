"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();Object.defineProperty(exports,"__esModule",{value:!0});var Store_1=require("./Store");describe("Store",function(){it("an action can create a new field",function(){var t=new(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.action1=function(){this.action("action1",function(t){t.field1=1})},n}(Store_1.Store))({}),n=[];t.select("field1").subscribe(function(t){return n.push(t.data.field1)}),t.action1(),assert.equal(t.data.field1,1),assert.deepEqual(n,[1])}),it("an action can change a field",function(){var t=new(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.action1=function(){this.action("action1",function(t){t.field1=1})},n}(Store_1.Store))({field1:0});assert.equal(t.data.field1,0);var n=[];t.select("field1").subscribe(function(t){return n.push(t.data.field1)}),t.action1(),assert.equal(t.data.field1,1),assert.deepEqual(n,[0,1])}),it("an action can set a field to undefined",function(){var t=new(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.action1=function(){this.action("action1",function(t){t.field1=void 0})},n}(Store_1.Store))({field1:1}),n=[];t.select("field1").subscribe(function(t){return n.push(t.data.field1)}),t.action1(),assert.isUndefined(t.data.field1),assert.deepEqual(n,[1,void 0])}),it("access to this.data is isolated inside an action",function(t){new(function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e.prototype.action1=function(){var n=this;this.action("action1",function(e){e.field1=1,assert.equal(n.data.field1,0),assert.equal(e.field1,1),t()})},e}(Store_1.Store))({field1:0}).action1()}),it("nested actions can see dirty outer changes",function(t){new(function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e.prototype.action1=function(){var n=this;this.action("outer",function(e){e.field1=1,n.action("inner",function(n){assert.equal(n.field1,1),t()})})},e}(Store_1.Store))({field1:0}).action1()}),it("changes done by nested actions will afterwards be visible in outer actions",function(t){new(function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e.prototype.action1=function(){var n=this;this.action("outer",function(e){e.field1=1,assert.equal(e.field1,1),n.action("inner",function(t){assert.equal(t.field1,1),t.field1=2,assert.equal(t.field1,2)}),assert.equal(e.field1,2),t()})},e}(Store_1.Store))({field1:0}).action1()}),it("nested actions can be asynchronous",function(t){var n=[],e=new(function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.action1=function(){var e=this;this.action("outer",function(i){setTimeout(function(){e.action("inner",function(t){t.field1=2},{afterAction:function(){assert.deepEqual(n,[0,1,2]),t()}})},0),i.field1=1})},i}(Store_1.Store))({field1:0});e.select("field1").subscribe(function(t){return n.push(t.data.field1)}),e.action1()}),it("callback afterAction",function(t){new(function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e.prototype.action1=function(){this.action("action1",function(t){t.field1=1,t.field2=5},{afterAction:function(n,e,i,o){assert.equal(e.field1,1),assert.equal(e.field2,5),assert.deepEqual(Array.from(i),["field1"]),assert.deepEqual(Array.from(o),["field2"]),t()}})},e}(Store_1.Store))({field1:0}).action1()})});
//# sourceMappingURL=Store.test.js.map
