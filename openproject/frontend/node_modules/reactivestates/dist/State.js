"use strict";function observableToState(t){return new State(t,function(t){return void 0===t},function(t,e){t.pristine&&e(void 0)},function(t,e){t.hasValue()&&e(void 0)})}Object.defineProperty(exports,"__esModule",{value:!0});var rxjs_1=require("rxjs"),log_1=require("./log"),State=function(){function t(t,e,n,r){var i=this;this.isNonValue=e,this.afterConnect=n,this.afterDisconnect=r,this.name=null,this.logEnabled=!0,this.pristine=!0,this.outputStreamTrailing=new rxjs_1.ReplaySubject(1),this.observerCount=0,this.timestampOfLastValue=-1,this.outputStream=new rxjs_1.ReplaySubject(1),this.value$=this.outputStream.filter(function(t){return!i.isNonValue(t)}),this.nonValue$=this.outputStream.filter(function(t){return i.isNonValue(t)}),this.inputStream=t,this.connect()}return t.prototype.connect=function(){var t=this;return this.isConnected()&&this.disconnect(),this.sourceSubscription=this.inputStream.subscribe(function(e){t.setInnerValue(e)}),this.afterConnect(this,this.setInnerValue.bind(this)),this},t.prototype.disconnect=function(){return this.afterDisconnect(this,this.setInnerValue.bind(this)),this.sourceSubscription&&this.sourceSubscription.unsubscribe(),this.sourceSubscription=void 0,this.pristine=!0,this},t.prototype.isConnected=function(){return void 0!==this.sourceSubscription},t.prototype.isValueOlderThan=function(t){return Date.now()-this.timestampOfLastValue>t},t.prototype.hasValue=function(){return!this.isNonValue(this.stateValue)},t.prototype.changes$=function(t){return this.wrapObserve(this.outputStream.asObservable(),t)},t.prototype.changesPromise=function(){return this.changes$().take(1).toPromise()},t.prototype.values$=function(t){return this.wrapObserve(this.value$,t)},t.prototype.valuesPromise=function(){return this.values$().take(1).toPromise()},t.prototype.nonValues$=function(t){return this.wrapObserve(this.nonValue$,t)},t.prototype.nonValuesPromise=function(){return this.nonValues$().take(1).toPromise()},Object.defineProperty(t.prototype,"value",{get:function(){return this.stateValue},enumerable:!0,configurable:!0}),t.prototype.getValueOr=function(t){return this.hasValue()?this.value:t},t.prototype.mapOr=function(t,e){return this.hasValue()?t(this.value):e},t.prototype.forEach=function(t){return this.values$().subscribe(function(e){return t(e)}),this},Object.defineProperty(t.prototype,"text",{get:function(){return this.hasValue()?this.value.toString():""},enumerable:!0,configurable:!0}),t.prototype.getSubscriberCount=function(){return this.observerCount},t.prototype.hasSubscribers=function(){return this.getSubscriberCount()>0},t.prototype.onObserverSubscribed=function(){},t.prototype.onObserverUnsubscribed=function(){},t.prototype.log=function(){log_1.logStateChange(this)},t.prototype.setInnerValue=function(t){this.stateValue=t,this.pristine=!1,this.logEnabled&&this.log(),this.isNonValue(t)?this.timestampOfLastValue=-1:this.timestampOfLastValue=Date.now(),this.outputStream.next(t),this.outputStreamTrailing.next(t)},t.prototype.wrapObserve=function(t,e){var n=this;return rxjs_1.Observable.create(function(e){n.observerCount++,n.onObserverSubscribed();var r=t.subscribe(function(t){e.next(t)},function(t){e.error(t)},function(){e.complete()});return function(){r.unsubscribe(),n.observerCount--,n.onObserverUnsubscribed()}})},t}();exports.State=State,exports.observableToState=observableToState;
//# sourceMappingURL=State.js.map
